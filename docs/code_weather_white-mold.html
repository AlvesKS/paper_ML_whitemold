<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.194">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Data &amp; Codes - Weather data</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <link href="./code_soil_variables_white-mold.html" rel="next">
  <link href="./about.html" rel="prev">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="site_libs/bootstrap/bootstrap-dark.min.css">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "end",
    "type": "textbox",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Data &amp; Codes - Weather data">
<meta property="og:site-name" content="Data &amp; Codes">
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Weather data</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data &amp; Codes</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com/AlvesKS_" title="" class="sidebar-tool px-1"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/AlvesKS/paper_ML_whitemold" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="https://osf.io/v53py/" title="" class="sidebar-tool px-1"><i class="bi bi-download"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Repository</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">About this repository</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">About this study</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Data sources</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_weather_white-mold.html" class="sidebar-item-text sidebar-link active">Weather data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_soil_variables_white-mold.html" class="sidebar-item-text sidebar-link">Soil data</a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Data analysis</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_fda_white-mold.html" class="sidebar-item-text sidebar-link">Functional data analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_boosting_white-mold.html" class="sidebar-item-text sidebar-link">XgBoost model</a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#packages" id="toc-packages" class="nav-link active" data-scroll-target="#packages">Packages</a></li>
<li><a href="#white-mold-data" id="toc-white-mold-data" class="nav-link" data-scroll-target="#white-mold-data">White mold data</a>
<ul class="collapse">
<li><a href="#removing-missing-coordinates" id="toc-removing-missing-coordinates" class="nav-link" data-scroll-target="#removing-missing-coordinates">Removing missing coordinates</a></li>
<li><a href="#names-of-the-counties-in-the-dataset" id="toc-names-of-the-counties-in-the-dataset" class="nav-link" data-scroll-target="#names-of-the-counties-in-the-dataset">Names of the counties in the dataset</a></li>
<li><a href="#ploting-the-location-of-each-field" id="toc-ploting-the-location-of-each-field" class="nav-link" data-scroll-target="#ploting-the-location-of-each-field">Ploting the location of each field</a></li>
</ul></li>
<li><a href="#era5" id="toc-era5" class="nav-link" data-scroll-target="#era5"><span>ERA5</span></a></li>
<li><a href="#era5-land-hourly-data-from-1950-to-present" id="toc-era5-land-hourly-data-from-1950-to-present" class="nav-link" data-scroll-target="#era5-land-hourly-data-from-1950-to-present">ERA5-Land hourly data from 1950 to present</a>
<ul class="collapse">
<li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing data</a>
<ul class="collapse">
<li><a href="#m-temperature" id="toc-m-temperature" class="nav-link" data-scroll-target="#m-temperature">2m temperature</a></li>
<li><a href="#m-dewpoint-temperature" id="toc-m-dewpoint-temperature" class="nav-link" data-scroll-target="#m-dewpoint-temperature">2m dewpoint temperature</a></li>
<li><a href="#surface-pressure" id="toc-surface-pressure" class="nav-link" data-scroll-target="#surface-pressure">Surface pressure</a></li>
<li><a href="#soil-moisture" id="toc-soil-moisture" class="nav-link" data-scroll-target="#soil-moisture">soil moisture</a></li>
<li><a href="#soil-temperature" id="toc-soil-temperature" class="nav-link" data-scroll-target="#soil-temperature">soil temperature</a></li>
</ul></li>
<li><a href="#kringing-test" id="toc-kringing-test" class="nav-link" data-scroll-target="#kringing-test">Kringing Test</a>
<ul class="collapse">
<li><a href="#weather-data" id="toc-weather-data" class="nav-link" data-scroll-target="#weather-data">Weather data</a></li>
<li><a href="#ny-shapefile" id="toc-ny-shapefile" class="nav-link" data-scroll-target="#ny-shapefile">NY shapefile</a></li>
<li><a href="#masking" id="toc-masking" class="nav-link" data-scroll-target="#masking">Masking</a></li>
<li><a href="#downloading-digital-elevation-model-dem" id="toc-downloading-digital-elevation-model-dem" class="nav-link" data-scroll-target="#downloading-digital-elevation-model-dem">Downloading Digital elevation model (DEM)</a></li>
<li><a href="#kringing" id="toc-kringing" class="nav-link" data-scroll-target="#kringing">Kringing</a></li>
<li><a href="#visualization-1" id="toc-visualization-1" class="nav-link" data-scroll-target="#visualization-1">Visualization</a></li>
</ul></li>
<li><a href="#daily-summaries" id="toc-daily-summaries" class="nav-link" data-scroll-target="#daily-summaries">Daily summaries</a>
<ul class="collapse">
<li><a href="#lapply" id="toc-lapply" class="nav-link" data-scroll-target="#lapply">Lapply</a></li>
<li><a href="#download-dem" id="toc-download-dem" class="nav-link" data-scroll-target="#download-dem">Download DEM</a></li>
<li><a href="#kriging-the-daily-summaries" id="toc-kriging-the-daily-summaries" class="nav-link" data-scroll-target="#kriging-the-daily-summaries">Kriging the daily summaries</a></li>
<li><a href="#ploting-the-kingued-maps-first-layer" id="toc-ploting-the-kingued-maps-first-layer" class="nav-link" data-scroll-target="#ploting-the-kingued-maps-first-layer">Ploting the kingued maps (first layer)</a></li>
<li><a href="#relative-humidity" id="toc-relative-humidity" class="nav-link" data-scroll-target="#relative-humidity">Relative humidity</a></li>
</ul></li>
<li><a href="#extracting-data" id="toc-extracting-data" class="nav-link" data-scroll-target="#extracting-data">Extracting data</a>
<ul class="collapse">
<li><a href="#saving-data" id="toc-saving-data" class="nav-link" data-scroll-target="#saving-data">Saving data</a></li>
</ul></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/AlvesKS/paper_ML_whitemold/edit/main/code_weather_white-mold.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/AlvesKS/paper_ML_whitemold/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">

<div class="quarto-title"><h1 class="title d-none d-lg-block display-7">Weather data</h1></div></header>

<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
About R packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure to have all R packages installed before running the analysis described in this website.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(KrigR)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MetBrewer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="white-mold-data" class="level2">
<h2 class="anchored" data-anchor-id="white-mold-data">White mold data</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wm_data <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data_white-mold/WhiteMoldSurveyWrangledData.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="removing-missing-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="removing-missing-coordinates">Removing missing coordinates</h3>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wm_data2 <span class="ot">=</span> wm_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(latitude))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="names-of-the-counties-in-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="names-of-the-counties-in-the-dataset">Names of the counties in the dataset</h3>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">=</span> <span class="fu">unique</span>(wm_data2<span class="sc">$</span>county)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>counties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Genesee"    "Niagara"    "Orleans"    "Livingston" "Wyoming"   
[6] "Ontario"    "Yates"      "Chautauqua" "Monroe"    </code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>central_ny <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"wyoming"</span>, <span class="st">"livingston"</span>,<span class="st">"ontario"</span>,<span class="st">"yates"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ploting-the-location-of-each-field" class="level3">
<h3 class="anchored" data-anchor-id="ploting-the-location-of-each-field">Ploting the location of each field</h3>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#covert the names to lowercase</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>map_snap_fun <span class="ot">=</span> <span class="cf">function</span>(yearr){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>counties_lc <span class="ot">=</span> <span class="fu">tolower</span>(counties)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ny_map_data <span class="ot">=</span> <span class="fu">map_data</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>snap_map <span class="ot">=</span> ny_map_data <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subregion <span class="sc">%in%</span> counties_lc) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region2 =</span> <span class="fu">case_when</span>(subregion <span class="sc">%in%</span> central_ny <span class="sc">~</span> <span class="st">"Central lakes"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">!</span>subregion <span class="sc">%in%</span> central_ny <span class="sc">~</span> <span class="st">"Great lakes"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_map_data,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="st">"white"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill=</span>region2),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>               <span class="co"># fill= "gray90",</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2 <span class="sc">%&gt;%</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(subject) <span class="sc">%&gt;%</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(dap <span class="sc">==</span> <span class="fu">max</span>(dap),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">!</span><span class="fu">is.na</span>(wm)) <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(year <span class="sc">==</span> yearr)  , </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.4</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude, <span class="at">color =</span> wm<span class="sc">&gt;</span><span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.7</span>),</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>, <span class="fl">43.5</span>))<span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>)<span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not-present"</span>, <span class="st">"Present"</span>))<span class="sc">+</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">2</span>)),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Climate division"</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"White mold"</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">paste</span>(yearr))<span class="sc">+</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~year, ncol = 1)+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>))</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>snap_map</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ny_map_data <span class="ot">=</span> <span class="fu">map_data</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>counties_lc <span class="ot">=</span> <span class="fu">tolower</span>(counties)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ny_map <span class="ot">=</span> ny_map_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(subregion <span class="sc">%in%</span> counties_lc) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region2 =</span> <span class="fu">case_when</span>(subregion <span class="sc">%in%</span> central_ny <span class="sc">~</span> <span class="st">"Central lakes"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">!</span>subregion <span class="sc">%in%</span> central_ny <span class="sc">~</span> <span class="st">"Great lakes"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_map_data,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="st">"white"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill=</span>region2),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>               <span class="co"># fill= "gray90",</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span><span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="sc">-</span><span class="dv">80</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">76.5</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ymin =</span> <span class="fl">41.8</span>, <span class="at">ymax =</span> <span class="fl">43.5</span>,<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_map(xlim = c(-80,-73),</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ylim = c(40, 45))+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()<span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>)<span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Climate division"</span>)<span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.8</span>))</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>ny_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">map_snap_fun</span>(<span class="at">yearr =</span> <span class="st">"2006"</span>) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map_snap_fun</span>(<span class="at">yearr =</span> <span class="st">"2007"</span>)<span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map_snap_fun</span>(<span class="at">yearr =</span> <span class="st">"2008"</span>)<span class="sc">+</span><span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">'collect'</span>)<span class="sc">&amp;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="st">"left"</span>,<span class="st">"center"</span>))) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  (ny_map<span class="sc">+</span><span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">'keep'</span>)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot_layout(ncol = 2)+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)<span class="sc">&amp;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">6</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">'cm'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figs/maps/maps_fields.png"</span>, <span class="at">dpi=</span> <span class="dv">900</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="era5" class="level2">
<h2 class="anchored" data-anchor-id="era5"><a href="https://confluence.ecmwf.int/display/CKB/The+family+of+ERA5+datasets">ERA5</a></h2>
<ul>
<li><p>ERA5-Land hourly data from 1950 to present <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land?tab=overview">Description</a></p>
<ul>
<li><p>0.1° x 0.1°; Native resolution is 9 km</p></li>
<li><p>Global</p></li>
<li><p>Hourly</p></li>
<li><p>January 1950 to present</p></li>
</ul></li>
<li><p>ERA5 hourly data on pressure levels from 1979 to present <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview">Description</a></p>
<ul>
<li><p>Reanalysis: 0.25° x 0.25°</p></li>
<li><p>Global</p></li>
<li><p>Hourly</p></li>
<li><p>1979 to present</p></li>
</ul></li>
<li><p>Agrometeorological indicators from 1979 to present derived from reanalysis <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/sis-agrometeorological-indicators?tab=overview">Description</a></p>
<ul>
<li><p>0.1° x 0.1°</p></li>
<li><p>Global</p></li>
<li><p>Daily</p></li>
<li><p>1979 to present</p></li>
</ul></li>
<li><p>There is a package for downloading the data using R: <a href="https://bluegreen-labs.github.io/ecmwfr/">link</a></p></li>
</ul>
</section>
<section id="era5-land-hourly-data-from-1950-to-present" class="level1">
<h1>ERA5-Land hourly data from 1950 to present</h1>
<p>Besides there is a package for downloading data from Era5, I chose using their website to download the data. The process, using their website or the R pakage require making a request and waiting a long time to get the data.</p>
<p>These are the codes for each variable inside the <code>NETCDF</code> files.</p>
<ul>
<li><code>u10</code>, <code>d2m</code>, <code>t2m</code>, <code>lai_hv</code>, <code>lai_lv</code>, <code>src</code>, <code>skt</code>, <code>stl2</code>, <code>sp</code>, <code>tp</code>, <code>swvl1</code>, <code>swvl2</code>, <code>swvl3</code>, <code>swvl4</code></li>
</ul>
<p>For now, we are going to use only these variables:</p>
<ul>
<li><code>t2m</code>: 2m temperature</li>
<li><code>d2m</code>: 2m dew point temperature</li>
<li><code>sp</code>: Surface pressure</li>
<li><code>swvl1</code>: Soil moisture</li>
<li><code>stl1</code>: Soil temperature</li>
</ul>
<blockquote class="blockquote">
<p>Relative humidity can be calculated from t2m, d2m, and sp.</p>
</blockquote>
<section id="importing-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-data">Importing data</h2>
<p>Here I load the data for each data variable and gather into a single raster object.</p>
<section id="m-temperature" class="level3">
<h3 class="anchored" data-anchor-id="m-temperature">2m temperature</h3>
<!-- ```{r eval=FALSE, include=FALSE} -->
<!-- t2m_2006 <- raster::stack("data_era5/era5_NY_2006.nc", varname = "t2m") -->
<!-- t2m_2007 <- raster::stack("data_era5/era5_NY_2007.nc", varname = "t2m") -->
<!-- t2m_2008 <- raster::stack("data_era5/era5_NY_2008.nc", varname = "t2m") -->
<!-- t2m_all = stack(t2m_2006, t2m_2007, t2m_2008) -->
<!-- ``` -->
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>t2m_all <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008.nc"</span>, <span class="at">varname =</span> <span class="st">"t2m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="m-dewpoint-temperature" class="level3">
<h3 class="anchored" data-anchor-id="m-dewpoint-temperature">2m dewpoint temperature</h3>
<!-- ```{r eval=FALSE, include=FALSE} -->
<!-- d2m_2006 <- raster::stack("data_era5/era5_NY_2006.nc", varname = "d2m") -->
<!-- d2m_2007 <- raster::stack("data_era5/era5_NY_2007.nc", varname = "d2m") -->
<!-- d2m_2008 <- raster::stack("data_era5/era5_NY_2008.nc", varname = "d2m") -->
<!-- d2m_all = stack(d2m_2006, d2m_2007, d2m_2008) -->
<!-- ``` -->
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>d2m_all <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008.nc"</span>, <span class="at">varname =</span> <span class="st">"d2m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="surface-pressure" class="level3">
<h3 class="anchored" data-anchor-id="surface-pressure">Surface pressure</h3>
<!-- ```{r eval=FALSE, include=FALSE} -->
<!-- sp_2006 <- raster::stack("data_era5/era5_NY_2006.nc", varname = "sp") -->
<!-- sp_2007 <- raster::stack("data_era5/era5_NY_2007.nc", varname = "sp") -->
<!-- sp_2008 <- raster::stack("data_era5/era5_NY_2008.nc", varname = "sp") -->
<!-- sp_all = stack(sp_2006, sp_2007, sp_2008) -->
<!-- ``` -->
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sp_all <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008.nc"</span>, <span class="at">varname =</span> <span class="st">"sp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-moisture" class="level3">
<h3 class="anchored" data-anchor-id="soil-moisture">soil moisture</h3>
<!-- ```{r eval=FALSE, include=FALSE} -->
<!-- swvl1_2006 <- raster::stack("data_era5/era5_NY_2006.nc", varname = "swvl1") -->
<!-- swvl1_2007 <- raster::stack("data_era5/era5_NY_2007.nc", varname = "swvl1") -->
<!-- swvl1_2008 <- raster::stack("data_era5/era5_NY_2008.nc", varname = "swvl1") -->
<!-- swvl1_all = stack(swvl1_2006, swvl1_2007, swvl1_2008) -->
<!-- ``` -->
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>swvl1_all <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008.nc"</span>, <span class="at">varname =</span> <span class="st">"swvl1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-temperature" class="level3">
<h3 class="anchored" data-anchor-id="soil-temperature">soil temperature</h3>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>stl1_all <span class="ot">=</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008_2.nc"</span>, <span class="at">varname =</span> <span class="st">"stl1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="kringing-test" class="level2">
<h2 class="anchored" data-anchor-id="kringing-test">Kringing Test</h2>
<p>Kriniging was performed following this <a href="https://www.erikkusch.com/post/krigr-mats/krigrworkshop/#kriging-by-shapefile">tutorial</a></p>
<section id="weather-data" class="level3">
<h3 class="anchored" data-anchor-id="weather-data">Weather data</h3>
<p>Here I load the temperature data, select one layer (time and day) and plot it together with the New York map</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(<span class="st">"data_era5/era5_NY_2006-2008.nc"</span>, <span class="at">varname =</span> <span class="st">"t2m"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> r<span class="sc">$</span>X2008.<span class="dv">05</span>.<span class="dv">01</span>.<span class="dv">00</span>.<span class="fl">00.00</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(a)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(wm_data2<span class="sc">$</span>longitude, wm_data2<span class="sc">$</span>latitude)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>, <span class="at">col =</span> <span class="st">"#5E610B"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="ny-shapefile" class="level3">
<h3 class="anchored" data-anchor-id="ny-shapefile">NY shapefile</h3>
<p>We will need the New York shapefile to download the digital elevation map, which should be used for kriging. I also filter only the counties that have been surveyed for white mold.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Dir.StateShp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data_era5/test"</span>)<span class="co"># file.path("shape_files/nc_files")</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> ny_shape1 <span class="ot">=</span> <span class="fu">readOGR</span>(<span class="st">"shape_files/cugir-007865/cugir-007865/cty036.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>OGR data source with driver: ESRI Shapefile 
Source: "G:\.shortcut-targets-by-id\1tp3HzkoBOZ0949rE6UQ-y3_WEWrnsmPw\WhiteMoldSurvey\01-Kaique\01-Repository\shape_files\cugir-007865\cugir-007865\cty036.shp", layer: "cty036"
with 67 features
It has 80 fields</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a> ny_shape <span class="ot">=</span> ny_shape1[ny_shape1<span class="sc">$</span>NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">unique</span>(wm_data2<span class="sc">$</span>county)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="co"># "Yates", "Steuben","Allegany", "Cattaraugus","Erie"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                            ),] </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ny_shape)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(wm_data2<span class="sc">$</span>longitude, wm_data2<span class="sc">$</span>latitude,<span class="at">pch =</span> <span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="masking" class="level3">
<h3 class="anchored" data-anchor-id="masking">Masking</h3>
<p>Here we make make a mask to filter only the data for the selected counties.</p>
<p>The <code>KrigR::mask_Shape()</code> function is diferent from the <code>raster::mask()</code>. The <code>KrigR::mask_Shape()</code> create a new raster object with all cells in the original raster which are at least partially covered by the supplied shapefile. The <code>raster::mask()</code> removes the cells that are partially covered by the shapefile.</p>
<p>Note that the <code>KrigR::mask_Shape()</code> returns a raster filled with <code>1</code> (<code>a11</code>). So I transform that raster to a polygon object (<code>a21</code>) and use it as shapefile to mask all the datasets from now on.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a raster covering the selected counties. Note that all cells has the value 1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>a11 <span class="ot">=</span> <span class="fu">mask_Shape</span>(a, ny_shape)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a polygon from the previous raster file (this is going to be our mask fot the all datasets) </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>a21 <span class="ot">=</span> <span class="fu">rasterToPolygons</span>(a11, <span class="at">dissolve=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Loading required namespace: rgeos</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Warning in rasterToPolygons(a11, dissolve = T): package rgeos is not available.
Cannot dissolve</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask our example dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">=</span> <span class="fu">mask</span>(a,a21)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a11, <span class="at">main =</span> <span class="st">"NULL raster file"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a21, <span class="at">main =</span> <span class="st">"Mask"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a2, <span class="at">main =</span> <span class="st">"Masked raster data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ori_data_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(a2, <span class="at">xy =</span> T) </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ori_data_df)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"values"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ori_g<span class="ot">=</span> ori_data_df <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(values)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(x, y, <span class="at">fill =</span> values))<span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="cn">NA</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option=</span><span class="st">"B"</span>)<span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>,<span class="fl">43.5</span>))<span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"black"</span>, </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude))<span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span> <span class="st">"Era5 original"</span>)<span class="sc">+</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Regions defined for each Polygons</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ori_g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="downloading-digital-elevation-model-dem" class="level3">
<h3 class="anchored" data-anchor-id="downloading-digital-elevation-model-dem">Downloading Digital elevation model (DEM)</h3>
<p>Function to plot the DEM</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/Plot_Covs.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Downloading DEM</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Covs_ls <span class="ot">&lt;-</span> <span class="fu">download_DEM</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Train_ras =</span> a2,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Target_res =</span> .<span class="dv">02</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Shape =</span> ny_shape,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.StateShp,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">TRUE</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Plot_Covs</span>(Covs_ls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="visualization" class="level5">
<h5 class="anchored" data-anchor-id="visualization">Visualization</h5>
<p>…Using <code>ggplot2</code></p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(Covs_ls[[<span class="dv">2</span>]], <span class="at">xy =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(DEM)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(x,y,<span class="at">fill =</span> DEM))<span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="cn">NA</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2, <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude))<span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span><span class="fu">met.brewer</span>(<span class="st">"Homer2"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>,<span class="fl">43.5</span>))<span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span> <span class="st">"Era5 original"</span>)<span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Regions defined for each Polygons</code></pre>
</div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"figs/maps/elevation.png"</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="kringing" class="level3">
<h3 class="anchored" data-anchor-id="kringing">Kringing</h3>
<p>This function performs kriging of the weather variables as function of the DEM data</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>KrigStart <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>State_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> a2, <span class="co"># what to krig</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">1</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"State_Shape.nc"</span>, <span class="co"># save the finished file as this _t2m_2008.nc</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.StateShp <span class="co"># where to save the output</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Commencing Kriging</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Kriging of remaining 0 data layers should finish around: 2022-06-22 17:24:26</code></pre>
</div>
<div class="cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>KrigStop <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>KrigStop<span class="sc">-</span>KrigStart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Time difference of 2.086116 secs</code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(State_Krig<span class="sc">$</span>Kriging_SE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="visualization-1">Visualization</h3>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Krigs <span class="ot">=</span> State_Krig<span class="sc">$</span>Kriging_Output</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Krigs = State_Krig$Kriging_SE</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>Krig_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Krigs[[<span class="dv">1</span>]], <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Krig_df)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"values"</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>krig_g <span class="ot">=</span> Krig_df <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(values)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(x, y, <span class="at">fill =</span> values))<span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="cn">NA</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option=</span><span class="st">"B"</span>)<span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis(option="B")+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude))<span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>()<span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span> <span class="st">"Era5 kriged"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Regions defined for each Polygons</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ori_g <span class="sc">+</span> krig_g <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>,<span class="fl">43.5</span>))<span class="sc">&amp;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
</section>
<section id="daily-summaries" class="level2">
<h2 class="anchored" data-anchor-id="daily-summaries">Daily summaries</h2>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">mean</span>(t2m_all[[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]]))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>, <span class="at">col =</span> <span class="st">"#5E610B"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">min</span>(t2m_all[[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]]))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>, <span class="at">col =</span> <span class="st">"#5E610B"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">max</span>(t2m_all[[<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]]))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>, <span class="at">col =</span> <span class="st">"#5E610B"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># days_in_month(month)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2008</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>month <span class="ot">=</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>day <span class="ot">=</span> <span class="dv">01</span><span class="sc">:</span><span class="dv">31</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>hour <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="dv">1</span>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>data_era5 <span class="ot">=</span> <span class="fu">expand_grid</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(month <span class="sc">!=</span> <span class="dv">4</span> <span class="sc">|</span> day <span class="sc">!=</span> <span class="dv">31</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>         month <span class="sc">!=</span> <span class="dv">6</span> <span class="sc">|</span> day <span class="sc">!=</span> <span class="dv">31</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>         month <span class="sc">!=</span> <span class="dv">9</span> <span class="sc">|</span> day <span class="sc">!=</span> <span class="dv">31</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(date, year, month, day,<span class="at">sep=</span><span class="st">"-"</span>,<span class="at">remove =</span> F ) <span class="sc">%&gt;%</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function for calculating the summaries</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mean_raster <span class="ot">=</span> <span class="cf">function</span>(i, stack_obj){</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(stack_obj[[i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">23</span>)]])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>min_raster <span class="ot">=</span> <span class="cf">function</span>(i, stack_obj){</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(stack_obj[[i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">23</span>)]])</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>max_raster <span class="ot">=</span> <span class="cf">function</span>(i, stack_obj){</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(stack_obj[[i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">23</span>)]])</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lapply" class="level3">
<h3 class="anchored" data-anchor-id="lapply">Lapply</h3>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>days_i <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(data_era5<span class="sc">$</span>day)<span class="sc">*</span><span class="dv">24</span>,<span class="at">by =</span> <span class="dv">24</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>time_start <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dew point</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>aa1 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, mean_raster, <span class="at">stack_obj=</span> d2m_all)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>d2m_mean_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa1), a21)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(d2m_mean_daily_stack),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/d2m_mean_daily.nc"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># temperature</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="do">### mean</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>aa2 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, mean_raster, <span class="at">stack_obj=</span> t2m_all)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>t2m_mean_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa2), a21)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(t2m_mean_daily_stack),</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/t2m_mean_daily.nc"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="do">### minimum</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>aa3 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, min_raster, <span class="at">stack_obj=</span> t2m_all)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>t2m_min_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa3), a21)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(t2m_min_daily_stack),</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/t2m_min_daily.nc"</span>,</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="do">### maximum</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>aa4 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, max_raster, <span class="at">stack_obj=</span> t2m_all)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>t2m_max_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa4), a21)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(t2m_max_daily_stack),</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/t2m_max_daily.nc"</span>,</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Surface pressure</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>aa5 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, mean_raster, <span class="at">stack_obj=</span> sp_all)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>sp_mean_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa5), a21)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(sp_mean_daily_stack),</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/sp_mean_daily.nc"</span>,</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Soil moisture</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>aa6 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, mean_raster, <span class="at">stack_obj=</span> swvl1_all)</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>swvl1_mean_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa6), a21)</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(swvl1_mean_daily_stack),</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/swvl1_mean_daily.nc"</span>,</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="co"># soil temperature</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>aa7 <span class="ot">=</span> <span class="fu">lapply</span>(days_i, mean_raster, <span class="at">stack_obj=</span> stl1_all)</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>stl1_mean_daily_stack <span class="ot">=</span> <span class="fu">mask</span>(<span class="fu">stack</span>(aa7), a21)</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(stl1_mean_daily_stack),</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/daily_summaries/stl1_mean_daily.nc"</span>,</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>time_end <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>time_end <span class="sc">-</span>time_start</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stl1_mean_daily_stack<span class="sc">$</span>X1)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">'county'</span>, <span class="at">region =</span> <span class="st">'new york'</span>,  <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="download-dem" class="level3">
<h3 class="anchored" data-anchor-id="download-dem">Download DEM</h3>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>Dir.krigd_var <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data_era5/kriged"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>Covs_ls <span class="ot">&lt;-</span> <span class="fu">download_DEM</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Train_ras =</span> d2m_mean_daily_stack,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Target_res =</span> .<span class="dv">02</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Shape =</span> ny_shape,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">TRUE</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">Plot_Covs</span>(Covs_ls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="kriging-the-daily-summaries" class="level3">
<h3 class="anchored" data-anchor-id="kriging-the-daily-summaries">Kriging the daily summaries</h3>
<section id="dew-point" class="level4">
<h4 class="anchored" data-anchor-id="dew-point">Dew point</h4>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time_start =Sys.time()</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>d2m_mean_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> d2m_mean_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"d2m_mean_daily_krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mean-temeperature" class="level4">
<h4 class="anchored" data-anchor-id="mean-temeperature">Mean Temeperature</h4>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>t2m_mean_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> t2m_mean_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"t2m_mean_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="minimum-temperature" class="level4">
<h4 class="anchored" data-anchor-id="minimum-temperature">Minimum temperature</h4>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>t2m_min_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> t2m_min_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"t2m_min_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maximum-temperature" class="level4">
<h4 class="anchored" data-anchor-id="maximum-temperature">Maximum temperature</h4>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>t2m_max_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> t2m_max_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"t2m_max_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="surface-pressure-1" class="level4">
<h4 class="anchored" data-anchor-id="surface-pressure-1">Surface pressure</h4>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sp_mean_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> sp_mean_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"sp_mean_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-temperature-1" class="level4">
<h4 class="anchored" data-anchor-id="soil-temperature-1">Soil temperature</h4>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>stl1_mean_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> stl1_mean_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"stl1_mean_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># time_end = Sys.time()</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time_end -time_start</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-moisture-1" class="level4">
<h4 class="anchored" data-anchor-id="soil-moisture-1">Soil moisture</h4>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>swvl1_mean_daily_Krig <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> swvl1_mean_daily_stack, <span class="co"># what to krig</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"swvl1_mean_daily_Krig.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># time_end = Sys.time()</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time_end -time_start</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(swvl1_mean_daily_Krig<span class="sc">$</span>Kriging_SE<span class="sc">$</span>var1.stdev<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>krigR_temporal <span class="ot">=</span> <span class="cf">function</span>(i, data){</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>cov1 <span class="ot">=</span> stl1_mean_daily_stack[[i]]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cov1) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"soilT"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>cov2 <span class="ot">=</span> stl1_mean_daily_Krig<span class="sc">$</span>Kriging_Output[[i]]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cov2) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"soilT"</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>Covs_ls2 <span class="ot">=</span> <span class="fu">list</span>(cov1, cov2)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>datax <span class="ot">=</span> <span class="fu">crop</span>(swvl1_mean_daily_stack[[i]],a21)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>xxxx <span class="ot">&lt;-</span> <span class="fu">krigR</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Data =</span> data[[i]], <span class="co"># what to krig</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_coarse =</span> Covs_ls2[[<span class="dv">1</span>]], <span class="co"># covariates at training resolution</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covariates_fine =</span> Covs_ls2[[<span class="dv">2</span>]], <span class="co"># covariates at target resolution</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Keep_Temporary =</span> <span class="cn">FALSE</span>, <span class="co"># delete temporary krigs of layers</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">KrigingEquation =</span> <span class="st">"ERA ~ soilT"</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cores =</span> <span class="dv">8</span>, <span class="co"># only run this on 1 core</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">FileName =</span> <span class="st">"swvl1_mean_daily_Krig2.nc"</span>, <span class="co"># save the finished file as this</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dir =</span> Dir.krigd_var <span class="co"># where to save the output</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(xxxx<span class="sc">$</span>Kriging_Output)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>nlayers <span class="ot">=</span> <span class="fu">length</span>(swvl1_mean_daily_stack<span class="sc">@</span>layers)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>swvl1_mean_daily_Krig2 <span class="ot">=</span> <span class="fu">stack</span>(<span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>nlayers, <span class="at">FUN =</span> krigR_temporal,<span class="at">data =</span> swvl1_mean_daily_stack ))</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(swvl1_mean_daily_Krig2),</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/kriged/swvl1_mean_daily_Krig2.nc"</span>,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>d2m_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/d2m_mean_daily_Krig.nc"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>t2m_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/t2m_mean_daily_Krig.nc"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>t2m_min_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/t2m_min_daily_Krig.nc"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>t2m_max_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/t2m_max_daily_Krig.nc"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>sp_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/sp_mean_daily_Krig.nc"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>swvl1_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/swvl1_mean_daily_Krig.nc"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>stl1_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/stl1_mean_daily_Krig.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ploting-the-kingued-maps-first-layer" class="level3">
<h3 class="anchored" data-anchor-id="ploting-the-kingued-maps-first-layer">Ploting the kingued maps (first layer)</h3>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t2m_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Mean Temp"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t2m_min_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Min Temp"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t2m_max_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Max Temp"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d2m_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Dew Point"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Surface Pressure"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(swvl1_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Soil Moisture"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stl1_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Soil Temp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using ggplot</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t2m_max_daily_stack</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>Krigs <span class="ot">=</span> t2m_max_daily_stack<span class="sc">$</span>X1</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>Krig_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Krigs[[<span class="dv">1</span>]], <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Krig_df)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"values"</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>max_t_ori <span class="ot">=</span> Krig_df <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(values)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="st">"white"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(x, y, <span class="at">fill =</span> values<span class="fl">-273.15</span>))<span class="sc">+</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="cn">NA</span>,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option=</span><span class="st">"B"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">18</span>),<span class="at">breaks =</span><span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis(option="B")+</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude))<span class="sc">+</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>,<span class="fl">43.5</span>))<span class="sc">+</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Max Temperature (°C)"</span>,</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span> <span class="st">"Era5 Native Resolution (0.1° x 0.1°)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Regions defined for each Polygons
Regions defined for each Polygons</code></pre>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># max_t_ori</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>Krigs <span class="ot">=</span> t2m_max_daily_Krig<span class="sc">$</span>X1</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Krig_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Krigs[[<span class="dv">1</span>]], <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Krig_df)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"values"</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>max_t_krig <span class="ot">=</span> Krig_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(values)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="st">"white"</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(x, y, <span class="at">fill =</span> values<span class="fl">-273.15</span>))<span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> ny_shape1,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill=</span> <span class="cn">NA</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option=</span><span class="st">"B"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">18</span>), <span class="at">breaks =</span><span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis(option="B")+</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> wm_data2,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(longitude,latitude))<span class="sc">+</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_map</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="fl">76.8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">41.8</span>,<span class="fl">43.5</span>))<span class="sc">+</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Max Temperature (°C)"</span>,</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span> <span class="st">"Era5 Kriged (0.02° x 0.02°)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Regions defined for each Polygons
Regions defined for each Polygons</code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>max_t_ori <span class="sc">+</span> max_t_krig <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()<span class="sc">&amp;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("figs/max_t.png",dpi=900, height = 8, width=14, bg = "white")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="relative-humidity" class="level3">
<h3 class="anchored" data-anchor-id="relative-humidity">Relative humidity</h3>
<p>How to calculate relative humidity here <a href="https://www.ecmwf.int/sites/default/files/elibrary/2016/17117-part-iv-physical-processes.pdf#subsection.7.4.2">link</a> and here <a href="https://confluence.ecmwf.int/display/CKB/ERA-Interim%3A+documentation">link</a></p>
<p><span class="math display">\[RH = \frac{es(d2m)}{es(t2m)}*100\]</span></p>
<p><span class="math inline">\(es()\)</span> is Saturation vapor pressure and can be calculated as</p>
<p><span class="math display">\[es(T) = \alpha_1*exp( \alpha_3*(\frac{T-t0}{T-\alpha_4}))\]</span>,</p>
<p>where <span class="math inline">\(T\)</span> is the temperature, <span class="math inline">\(\alpha_1 = 611.21\)</span>, <span class="math inline">\(\alpha_2 = 17.502\)</span>, <span class="math inline">\(\alpha_3 = 32.19\)</span>.</p>
<p>Using these resources, I build the function to calculates RH from Temperature and dew point.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>es <span class="ot">=</span><span class="cf">function</span>(Temp){</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">=</span> <span class="fl">273.16</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">=</span> <span class="fl">611.21</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>alpha3 <span class="ot">=</span> <span class="fl">17.502</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>alpha4 <span class="ot">=</span> <span class="fl">32.19</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>alpha1<span class="sc">*</span><span class="fu">exp</span>( alpha3<span class="sc">*</span>((Temp<span class="sc">-</span>t0)<span class="sc">/</span>(Temp<span class="sc">-</span>alpha4)))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co">#test</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>Tdp <span class="ot">=</span> <span class="dv">14</span><span class="fl">+273.15</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>T2m <span class="ot">=</span> <span class="dv">31</span><span class="fl">+273.15</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="fu">es</span>(Tdp)<span class="sc">/</span><span class="fu">es</span>(T2m)<span class="sc">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 35.55801</code></pre>
</div>
</div>
<p>Creating the raster object of relative humidity</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>layer_i <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nlayers</span>(d2m_mean_daily_Krig)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>calculate_RH <span class="ot">=</span> <span class="cf">function</span>(i, d2m_stack, t2m_stack){</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">es</span>(d2m_stack[[i]])<span class="sc">/</span><span class="fu">es</span>(t2m_stack[[i]])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>list_rh <span class="ot">=</span> <span class="fu">lapply</span>(layer_i, calculate_RH, <span class="at">d2m_stack =</span> d2m_mean_daily_Krig,<span class="at">t2m_stack=</span> t2m_mean_daily_Krig)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>rh_mean_daily_Krig <span class="ot">=</span> <span class="fu">brick</span>(list_rh)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="fu">writeCDF</span>(<span class="fu">rast</span>(rh_mean_daily_Krig),</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">"data_era5/kriged/rh_mean_daily_Krig.nc"</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rh_mean_daily_Krig <span class="ot">=</span> <span class="fu">stack</span>(<span class="st">"data_era5/kriged/rh_mean_daily_Krig.nc"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rh_mean_daily_Krig<span class="sc">$</span>X1, <span class="at">main =</span> <span class="st">"Relative Humidity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_weather_white-mold_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="extracting-data" class="level2">
<h2 class="anchored" data-anchor-id="extracting-data">Extracting data</h2>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>wm_data2_uni <span class="ot">=</span> wm_data2 <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subject) <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(1L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>coords<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">lon=</span>wm_data2_uni<span class="sc">$</span>longitude, <span class="at">lat=</span>wm_data2_uni<span class="sc">$</span>latitude)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(coords)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Dew point</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ext_d2m <span class="ot">=</span> <span class="fu">extract</span>(d2m_mean_daily_Krig, coords)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_d2m) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>ext_d2m_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                      ext_d2m )</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>d2m_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_d2m_coord) <span class="sc">%&gt;%</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject) <span class="sc">%&gt;%</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"d2m"</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>d2m_mean_wm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 241,392 × 5
   longitude latitude subject date         d2m
       &lt;dbl&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;date&gt;     &lt;dbl&gt;
 1     -77.9     42.9       1 2006-04-01  282.
 2     -77.9     42.9       1 2006-04-02  271.
 3     -77.9     42.9       1 2006-04-03  276.
 4     -77.9     42.9       1 2006-04-04  270.
 5     -77.9     42.9       1 2006-04-05  266.
 6     -77.9     42.9       1 2006-04-06  272.
 7     -77.9     42.9       1 2006-04-07  275.
 8     -77.9     42.9       1 2006-04-08  268.
 9     -77.9     42.9       1 2006-04-09  268.
10     -77.9     42.9       1 2006-04-10  270.
# … with 241,382 more rows</code></pre>
</div>
</div>
<ul>
<li>Mean Temperature</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>ext_t2m_mean <span class="ot">=</span> <span class="fu">extract</span>(t2m_mean_daily_Krig, coords)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_t2m_mean) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>ext_t2m_mean_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                           ext_t2m_mean)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>t2m_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_t2m_mean_coord) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"t2m_mean"</span>,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Max Temperature</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>ext_t2m_max <span class="ot">=</span> <span class="fu">extract</span>(t2m_max_daily_Krig, coords)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_t2m_max) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>ext_t2m_max_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                           ext_t2m_max)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>t2m_max_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_t2m_max_coord) <span class="sc">%&gt;%</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"t2m_max"</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Min Temperature</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ext_t2m_min <span class="ot">=</span> <span class="fu">extract</span>(t2m_min_daily_Krig, coords)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_t2m_min) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>ext_t2m_min_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                           ext_t2m_min)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>t2m_min_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_t2m_min_coord) <span class="sc">%&gt;%</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"t2m_min"</span>,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Pressure</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>ext_sp <span class="ot">=</span> <span class="fu">extract</span>(sp_mean_daily_Krig, coords)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_sp) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>ext_sp_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude, </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                      ext_sp )</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>sp_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_sp_coord) <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"sp"</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Soil moisture</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ext_sm <span class="ot">=</span> <span class="fu">extract</span>(swvl1_mean_daily_Krig, coords)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_sm) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>ext_sm_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude, </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                      ext_sm )</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>sm_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_sm_coord)<span class="sc">%&gt;%</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject) <span class="sc">%&gt;%</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"sm"</span>,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Relative humidity</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ext_rh <span class="ot">=</span> <span class="fu">extract</span>(rh_mean_daily_Krig, coords)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_rh) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>ext_rh_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                     ext_rh )</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>rh_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_rh_coord)<span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rh"</span>,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Soil temperature</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>ext_st <span class="ot">=</span> <span class="fu">extract</span>(stl1_mean_daily_Krig, coords)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ext_st) <span class="ot">=</span> <span class="fu">as.character</span>(data_era5<span class="sc">$</span>date)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ext_st_coord <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">longitude=</span>wm_data2_uni<span class="sc">$</span>longitude,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">latitude=</span>wm_data2_uni<span class="sc">$</span>latitude,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                     ext_st )</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>st_mean_wm <span class="ot">=</span> <span class="fu">as.data.frame</span>(ext_st_coord) <span class="sc">%&gt;%</span> </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject =</span>wm_data2_uni<span class="sc">$</span>subject)<span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">644</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"st"</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Binding data sets</p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>weather_all_wm <span class="ot">=</span> d2m_mean_wm <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(t2m_mean_wm[,<span class="dv">5</span>],</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>            t2m_max_wm[,<span class="dv">5</span>],</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>            t2m_min_wm[,<span class="dv">5</span>],</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>            sp_mean_wm[,<span class="dv">5</span>],</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>            sm_mean_wm[,<span class="dv">5</span>],</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            rh_mean_wm[,<span class="dv">5</span>],</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>            st_mean_wm[,<span class="dv">5</span>])</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>weather_all_wm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 241,392 × 12
   longitude latitude subject date         d2m t2m_mean t2m_max t2m_min     sp
       &lt;dbl&gt;    &lt;dbl&gt;   &lt;int&gt; &lt;date&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1     -77.9     42.9       1 2006-04-01  282.     284.    289.    281. 97567.
 2     -77.9     42.9       1 2006-04-02  271.     279.    285.    273. 98578.
 3     -77.9     42.9       1 2006-04-03  276.     282.    290.    277. 97387.
 4     -77.9     42.9       1 2006-04-04  270.     277.    284.    273. 97250.
 5     -77.9     42.9       1 2006-04-05  266.     273.    277.    270. 97416.
 6     -77.9     42.9       1 2006-04-06  272.     276.    283.    273. 97868.
 7     -77.9     42.9       1 2006-04-07  275.     278.    281.    275. 97193.
 8     -77.9     42.9       1 2006-04-08  268.     274.    277.    271. 97920.
 9     -77.9     42.9       1 2006-04-09  268.     275.    282.    270. 98859.
10     -77.9     42.9       1 2006-04-10  270.     278.    288.    272. 99093.
# … with 241,382 more rows, and 3 more variables: sm &lt;dbl&gt;, rh &lt;dbl&gt;, st &lt;dbl&gt;</code></pre>
</div>
</div>
<section id="saving-data" class="level3">
<h3 class="anchored" data-anchor-id="saving-data">Saving data</h3>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="ot">=</span> weather_all_wm <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>latitude, <span class="sc">-</span>longitude) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">full_join</span>(wm_data2, <span class="at">by =</span> <span class="st">"subject"</span>) </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_full, <span class="st">"data_white-mold/data_model_plus_weather.csv"</span>,<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>data_full <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data_white-mold/data_model_plus_weather.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sampling.date =</span>  <span class="fu">as.Date</span>(sampling.date),</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">planting.date =</span> <span class="fu">as.Date</span>(planting.date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>filter between planting and sampling dates</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data_fill_filtered <span class="ot">=</span> data_full <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> (planting.date<span class="dv">-30</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> sampling.date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_fill_filtered, <span class="st">"data_white-mold/data_model_plus_weather_filtered.csv"</span>,<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>data_fill_filtered <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data_white-mold/data_model_plus_weather_filtered.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Checking whether the filtering of the dates for each field worked -->



</section>
</section>
</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./about.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">About this study</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./code_soil_variables_white-mold.html" class="pagination-link">
        <span class="nav-page-text">Soil data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright © 2022 Kaique S. Alves</div>
  </div>
</footer>


</body></html>